- job:
    name: ci-pipeline-rpmbuild
    defaults: ci-pipeline-defaults
    parameters:
        - string:
            name: fed_username
            description: |
              fedmsg username
        - string:
            name: fed_stats
            description: |
              fedmsg stats
        - string:
            name: fed_name
            description: |
              fedmsg name
        - string:
            name: fed_namespace
            description: |
              fedmsg namespace
        - string:
            name: fed_rev
            description: |
              fedmsg rev
        - string:
            name: fed_agent
            description: |
              fedmsg agent
        - string:
            name: fed_summary
            description: |
              fedmsg summary
        - string:
            name: fed_repo
            description: |
              fedmsg repo
        - string:
            name: fed_branch
            description: |
              fedmsg branch
        - string:
            name: fed_path
            description: |
              fedmsg path
        - string:
            name: fed_seen
            description: |
              fedmsg seen
        - string:
            name: fed_message
            description: |
              fedmsg message
        - string:
            name: fed_email
            description: |
              fedmsg email
    builders:
#        - system-groovy:
#            command: build.description = build.getEnvironment().get('fed_repo')
        - ci-pipeline-duffy-builder:
            task: rpmbuild-test
            variables: |
                export JENKINS_JOB_NAME="${{JOB_NAME}}"
                export JENKINS_BUILD_TAG="${{BUILD_TAG}}"
                export OSTREE_BRANCH="${{OSTREE_BRANCH:-}}"
                export fed_repo="${{fed_repo}}"
                export fed_branch="${{fed_branch}}"
                export fed_rev="${{fed_rev}}"
            playbook: ci-pipeline/config/duffy-setup/setup-rpmbuild-system.yml
        - inject:
            properties-file: ${WORKSPACE}/logs/description.txt
#        - system-groovy:
#            command: build.description = build.getEnvironment().get('description')
    publishers:
        - archive:
            artifacts: '*.*, */*, */*/*'
            allow-empty: 'true'
        - trigger:
            project: 'ci-pipeline-ostree-compose'
            threshold: SUCCESS
        - ci-pipeline-duffy-publisher
